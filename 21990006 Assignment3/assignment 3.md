# Assignment 3

**Name: 田荫熙     SID：21990006 **

## Part 1. Description





### 1.概述

​    本次assignment为向量点积，实现了要求1中对输入数据的检查，具有良好的鲁棒性，200M大数据计算时间为600ms，只将其优化到400ms左右

### 2.输入检查

   程序中采用类封装向量，包含长度变量，存储地址，输入检查函数。将读入的数据转化为字符串，取每一位字符判断是否为数字。初始分配10000空间，满时扩大空间。

### 3.大数据

​    在堆内存new空间，分配失败则结束，在程序中赋值，分别统计IO时间和计算时间，优化前计算时间为600ms

### 4.优化

​    1.因为数据在L1级cache里读取计算最快，而800M数据无法全部放入L1级cache中，所以另设一个循环，L1级cache内存为8kb-32kb，故没4000个数为一组，缩小规模。

​    2.循环变量全部采用寄存器变量。

​    3.开启了多线程，多个线程虽然是并发运行的，但是有一些操作是必须一气呵成的，不允许打断的，这涉及到多线程的同步问题。对于一个资源被多个线程共用会导致程序的混乱，解决方法是只允许一个线程拥有对共享资源的独占，这里用互斥量(Mutex)来进行线程同步。

### 5.openblas

​    调用openblas库的cblas_sdot()函数时运行速度为50ms，快于我的程序，在float型数据中，当小数位数小于4位时，我的程序的long float型答案与openblas一致，当小数位数多于4位时，结果不一致。出现这种情况的原因是当ans已经累加到很大的值时，再加一个较小的值会出现精度损失。

## Part 2. Result & Verification

优化前![](C:\Users\tianyinxi\Desktop\2G~[DLY4GQ17]9N]]OGMXKY.png)



优化后

![](C:\Users\tianyinxi\Desktop\RDJ}A(8I3)7V58NR2L1ZF_5.png)



## Part 3. Difficulties & Solutions, or others

​     一开始想过用cuda加速GPU，用SSD指令集优化加速，但最后都失败了，只能从cache方面优化，并辅以多线程计算，优化效果不太明显，没有达到预期。

​    对我来说最难的还是openblas安装和连接，在网上找了大量的资料，又在官网上按着教程一步步走，但遇到了很多困难，首先是cmake的命令中找不到Cmakelist.txt文件，无法编译成.lib文件，耗费了大量时间去解决这个问题，然后是首次在VS中链接第三方库，也是找了很多教程才成功的。

  

*** 代码链接：***